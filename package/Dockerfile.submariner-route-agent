FROM fedora:33
ARG TARGETPLATFORM

WORKDIR /var/submariner

# These are all available in the UBI8 base OS repository
RUN dnf -y install --nodocs --setopt=install_weak_deps=0 iproute iptables && \
    dnf -y clean all

COPY package/submariner-route-agent.sh bin/${TARGETPLATFORM}/submariner-route-agent /usr/local/bin/

# Wrapper scripts to use iptables from the host when that's available
COPY package/iptables-wrapper.in /usr/sbin/

ENTRYPOINT submariner-route-agent.sh
